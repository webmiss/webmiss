<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>常用命令 | WebMIS文档</title>
    <meta name="description" content="WebMIS基于MVC框架开发的多用户、多权限开源解决方案，整合了Jquery、CodeMirror、TinyMCE、Chart等插件！">
    <link rel="icon" href="/img/favicon.png">
    
    <link rel="preload" href="/assets/css/0.styles.4b94f6ee.css" as="style"><link rel="preload" href="/assets/js/app.bdae1179.js" as="script"><link rel="preload" href="/assets/js/8.7187917d.js" as="script"><link rel="prefetch" href="/assets/js/10.a879d652.js"><link rel="prefetch" href="/assets/js/11.7f59ed00.js"><link rel="prefetch" href="/assets/js/12.1afa1544.js"><link rel="prefetch" href="/assets/js/13.87cff79d.js"><link rel="prefetch" href="/assets/js/2.b60a0c5f.js"><link rel="prefetch" href="/assets/js/3.b3f7c661.js"><link rel="prefetch" href="/assets/js/4.839be1dd.js"><link rel="prefetch" href="/assets/js/5.db2912be.js"><link rel="prefetch" href="/assets/js/6.436758b7.js"><link rel="prefetch" href="/assets/js/7.daa96e89.js"><link rel="prefetch" href="/assets/js/9.5a41f4a6.js">
    <link rel="stylesheet" href="/assets/css/0.styles.4b94f6ee.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container"><header class="navbar"><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><!----> <span class="site-name">WebMIS文档</span></a> <div class="links" style="max-width:nullpx;"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link router-link-active">Linux文档</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">PHP文档</a></li><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Web</a></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/webmiss" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar"><nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link">主页</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title">文档</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/linux/" class="nav-link router-link-active">Linux文档</a></li><li class="dropdown-item"><!----> <a href="/php/" class="nav-link">PHP文档</a></li><li class="dropdown-item"><!----> <a href="/web/" class="nav-link">Web</a></li></ul></div></div><div class="nav-item"><a href="https://www.github.com/webmiss" target="_blank" rel="noopener noreferrer" class="nav-link external">
  Github
  <svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a></div> <!----></nav>  <ul class="sidebar-links"><li><div class="sidebar-group first"><p class="sidebar-heading open"><span>Shell文档</span> <!----></p> <ul class="sidebar-group-items"><li><a href="/linux/shell/base.html" class="sidebar-link">Shell基础</a></li><li><a href="/linux/shell/tools.html" class="sidebar-link">常用工具</a></li><li><a href="/linux/shell/mysql.html" class="active sidebar-link">MariaDB数据库</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header"><a href="/linux/shell/mysql.html#常用命令" class="sidebar-link">常用命令</a></li><li class="sidebar-sub-header"><a href="/linux/shell/mysql.html#备份和恢复" class="sidebar-link">备份和恢复</a></li><li class="sidebar-sub-header"><a href="/linux/shell/mysql.html#ssh免密码登录" class="sidebar-link">SSH免密码登录</a></li></ul></li><li><a href="/linux/shell/docker.html" class="sidebar-link">Docker容器</a></li><li><a href="/linux/shell/nginx.html" class="sidebar-link">Nginx负载均衡</a></li><li><a href="/linux/shell/redis.html" class="sidebar-link">Redis消息列队</a></li></ul></div></li></ul> </div> <div class="page"> <div class="content"><h2 id="常用命令"><a href="#常用命令" aria-hidden="true" class="header-anchor">#</a> 常用命令</h2> <h3 id="设置root账户"><a href="#设置root账户" aria-hidden="true" class="header-anchor">#</a> 设置root账户</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 新密码</span>
mysql_secure_installation

<span class="token comment"># 登陆</span>
mysql -uroot -p

<span class="token comment"># 设置新密码</span>
mysqladmin -u root -password <span class="token operator">&lt;</span>新密码<span class="token operator">&gt;</span>

<span class="token comment"># 修改密码</span>
mysqladmin -u root -p <span class="token operator">&lt;</span>旧密码<span class="token operator">&gt;</span> password <span class="token operator">&lt;</span>新密码<span class="token operator">&gt;</span>

<span class="token comment"># 重启MariaDB</span>
systemctl restart mariadb
</code></pre></div><h3 id="创建用户"><a href="#创建用户" aria-hidden="true" class="header-anchor">#</a> 创建用户</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 创建新用户</span>
<span class="token string">'用户名'</span>@'<span class="token operator">&lt;</span>localhost<span class="token operator">&gt;</span><span class="token string">' IDENTIFIED BY '</span><span class="token operator">&lt;</span>密码<span class="token operator">&gt;</span><span class="token string">';

# 添加权限
grant SELECT,INSERT,UPDATE,DELETE on '</span><span class="token operator">&lt;</span>指定数据库<span class="token operator">&gt;</span><span class="token string">' to '</span><span class="token operator">&lt;</span>用户名<span class="token operator">&gt;</span><span class="token string">'@'</span>localhost<span class="token string">';

# 显示所有用户
select host,user from mysql.user;

# 删除用户
drop user '</span><span class="token operator">&lt;</span>用户名<span class="token operator">&gt;</span><span class="token string">'@'</span>localhost'<span class="token punctuation">;</span>
</code></pre></div><h3 id="数据库"><a href="#数据库" aria-hidden="true" class="header-anchor">#</a> 数据库</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查看</span>
<span class="token keyword">show</span> <span class="token keyword">databases</span><span class="token punctuation">;</span>

<span class="token comment"># 使用</span>
<span class="token keyword">use</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment"># 查看数据库编码</span>
<span class="token keyword">show</span> variables <span class="token operator">like</span> <span class="token string">'character_set_database'</span><span class="token punctuation">;</span>

<span class="token comment"># 新建数据库</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token comment"># 新建数据库并设置编码</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token operator">&lt;</span>utf8<span class="token operator">&gt;</span> <span class="token keyword">collate</span> <span class="token operator">&lt;</span>utf8_general_ci<span class="token operator">&gt;</span><span class="token punctuation">;</span>
<span class="token comment"># 更改数据库编码</span>
<span class="token keyword">alter</span> <span class="token keyword">database</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token operator">&lt;</span>utf8<span class="token operator">&gt;</span> <span class="token keyword">collate</span> <span class="token operator">&lt;</span>utf8_general_ci<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment"># 删除</span>
<span class="token keyword">drop</span> <span class="token keyword">database</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="数据表"><a href="#数据表" aria-hidden="true" class="header-anchor">#</a> 数据表</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查看</span>
<span class="token keyword">show</span> <span class="token keyword">tables</span><span class="token punctuation">;</span>

<span class="token comment"># 创建数据表</span>
<span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment"># 查看编码</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token comment"># 修改编码格式</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">character</span> <span class="token keyword">set</span> <span class="token operator">&lt;</span>utf8<span class="token operator">&gt;</span><span class="token punctuation">;</span>

<span class="token comment"># 删除</span>
<span class="token keyword">drop</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="字段"><a href="#字段" aria-hidden="true" class="header-anchor">#</a> 字段</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查看</span>
<span class="token keyword">show</span> <span class="token keyword">create</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
<span class="token comment"># 字段列信息</span>
<span class="token keyword">show</span> <span class="token keyword">columns</span> <span class="token keyword">from</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span>

<span class="token comment"># 添加</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">add</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token operator">not</span> <span class="token boolean">null</span> <span class="token keyword">COMMENT</span> <span class="token string">'&lt;备注&gt;'</span> <span class="token keyword">AFTER</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段后<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment"># 修改</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span> change <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">varchar</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">COLLATE</span> utf8_general_ci <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'&lt;备注&gt;'</span><span class="token punctuation">;</span>

<span class="token comment"># 删除</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">drop</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="索引"><a href="#索引" aria-hidden="true" class="header-anchor">#</a> 索引</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 索引信息</span>
<span class="token keyword">show</span> <span class="token keyword">index</span> <span class="token keyword">from</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span>

<span class="token comment"># 添加索引</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>数据库名<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span><span class="token operator">&lt;</span>字段<span class="token number">1</span><span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">(</span>长度<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段<span class="token number">2</span><span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">(</span>长度<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token comment"># - PRIMARY 主键，唯一不能为空。</span>
<span class="token comment"># - INDEX 索引，普通的。</span>
<span class="token comment"># - UNIQUE 唯一索引，不允许有重复可以为空。</span>
<span class="token comment"># - FULLTEXT 是全文索引，用于在一篇文章中，检索文本信息的。</span>

<span class="token comment"># 删除索引</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>表名<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">DROP</span> <span class="token keyword">INDEX</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>字段<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="分区"><a href="#分区" aria-hidden="true" class="header-anchor">#</a> 分区</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 用户表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token punctuation">(</span>
    <span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">INT</span> <span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ID'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>username<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'用户名'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>password<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span> <span class="token punctuation">(</span><span class="token number">32</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'密码'</span><span class="token punctuation">,</span>
    <span class="token punctuation">`</span>state<span class="token punctuation">`</span> <span class="token keyword">ENUM</span> <span class="token punctuation">(</span><span class="token string">'0'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'1'</span> <span class="token keyword">COMMENT</span> <span class="token string">'状态(0禁用,1正常)'</span><span class="token punctuation">,</span>
    <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token comment"># 添加数据</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span>
    <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>username<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>password<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>state<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token keyword">VALUES</span>
    <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'user1'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'user2'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token boolean">NULL</span><span class="token punctuation">,</span> <span class="token string">'user3'</span><span class="token punctuation">,</span> <span class="token string">'123456'</span><span class="token punctuation">,</span> <span class="token string">'1'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 分区（RANGE）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">partition</span> <span class="token keyword">BY</span> RANGE<span class="token punctuation">(</span>id<span class="token punctuation">)</span><span class="token punctuation">(</span>
    <span class="token keyword">partition</span> p0 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">partition</span> p1 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">partition</span> p2 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 查看</span>
<span class="token keyword">EXPLAIN</span> PARTITIONS <span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">;</span>

<span class="token comment"># 添加（RANGE）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">partition</span><span class="token punctuation">(</span>
    <span class="token keyword">partition</span> p3 <span class="token keyword">VALUES</span> LESS THAN maxvalue
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 拆分</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> REORGANIZE <span class="token keyword">partition</span> p3 <span class="token keyword">into</span><span class="token punctuation">(</span>
    <span class="token keyword">partition</span> p3 <span class="token keyword">VALUES</span> LESS THAN <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token keyword">partition</span> p4 <span class="token keyword">VALUES</span> LESS THAN maxvalue
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 合并</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> REORGANIZE <span class="token keyword">partition</span> p3<span class="token punctuation">,</span>p4 <span class="token keyword">into</span><span class="token punctuation">(</span>
    <span class="token keyword">partition</span> p3 <span class="token keyword">VALUES</span> LESS THAN maxvalue
<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 删除（包括数据）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">DROP</span> <span class="token keyword">partition</span> p0<span class="token punctuation">;</span>
<span class="token comment"># 删除（恢复非分区状态）</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> REMOVE partitioning<span class="token punctuation">;</span>

</code></pre></div><h3 id="外键"><a href="#外键" aria-hidden="true" class="header-anchor">#</a> 外键</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 创建数据库</span>
<span class="token keyword">create</span> <span class="token keyword">database</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span> <span class="token keyword">default</span> <span class="token keyword">character</span> <span class="token keyword">set</span> utf8 <span class="token keyword">collate</span> utf8_general_ci<span class="token punctuation">;</span>

<span class="token comment"># 用户基础表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">SMALLINT</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ID'</span> <span class="token punctuation">,</span>
	<span class="token punctuation">`</span>name<span class="token punctuation">`</span> <span class="token keyword">VARCHAR</span><span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'姓名'</span> <span class="token punctuation">,</span>
	<span class="token punctuation">`</span>sex<span class="token punctuation">`</span> <span class="token keyword">ENUM</span><span class="token punctuation">(</span><span class="token string">'男'</span><span class="token punctuation">,</span><span class="token string">'女'</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">'男'</span> <span class="token keyword">COMMENT</span> <span class="token string">'性别'</span> <span class="token punctuation">,</span>
	<span class="token punctuation">`</span>age<span class="token punctuation">`</span> <span class="token keyword">TINYINT</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token number">20</span> <span class="token keyword">COMMENT</span> <span class="token string">'年龄'</span> <span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token comment"># 用户信息表</span>
<span class="token keyword">CREATE</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>user_info<span class="token punctuation">`</span> <span class="token punctuation">(</span>
	<span class="token punctuation">`</span>id<span class="token punctuation">`</span> <span class="token keyword">SMALLINT</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">AUTO_INCREMENT</span> <span class="token keyword">COMMENT</span> <span class="token string">'ID'</span> <span class="token punctuation">,</span>
	<span class="token punctuation">`</span>uid<span class="token punctuation">`</span> <span class="token keyword">SMALLINT</span><span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span> <span class="token keyword">UNSIGNED</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">COMMENT</span> <span class="token string">'UID'</span> <span class="token punctuation">,</span>
	<span class="token punctuation">`</span>content<span class="token punctuation">`</span> <span class="token keyword">TEXT</span> <span class="token operator">NOT</span> <span class="token boolean">NULL</span> <span class="token keyword">DEFAULT</span> <span class="token string">''</span> <span class="token keyword">COMMENT</span> <span class="token string">'内容'</span> <span class="token punctuation">,</span>
	<span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token keyword">ENGINE</span> <span class="token operator">=</span> <span class="token keyword">InnoDB</span><span class="token punctuation">;</span>

<span class="token comment"># 添加索引</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> <span class="token punctuation">`</span>test<span class="token punctuation">`</span><span class="token punctuation">.</span><span class="token punctuation">`</span>user_info<span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">PRIMARY</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>uid<span class="token punctuation">`</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 添加外键</span>
<span class="token keyword">ALTER</span> <span class="token keyword">TABLE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">ADD</span> <span class="token keyword">CONSTRAINT</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>外键名称<span class="token operator">&gt;</span><span class="token punctuation">`</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">(</span><span class="token punctuation">`</span>id<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">REFERENCES</span> <span class="token punctuation">`</span>user_info<span class="token punctuation">`</span><span class="token punctuation">(</span><span class="token punctuation">`</span>uid<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">ON</span> <span class="token keyword">DELETE</span> <span class="token keyword">RESTRICT</span> <span class="token keyword">ON</span> <span class="token keyword">UPDATE</span> <span class="token keyword">RESTRICT</span><span class="token punctuation">;</span>
<span class="token comment"># - CASCADE 在父表上update/delete记录时，同步update/delete掉子表的匹配记录 </span>
<span class="token comment"># - SET NULL 在父表上update/delete记录时，将子表上匹配记录的列设为null (要注意子表的外键列不能为not null)  </span>
<span class="token comment"># - NO ACTION 如果子表中有匹配的记录,则不允许对父表对应候选键进行update/delete操作  </span>
<span class="token comment"># - RESTRICT 同no action, 都是立即检查外键约束</span>

<span class="token comment"># 删除外键</span>
<span class="token keyword">alter</span> <span class="token keyword">table</span> test<span class="token punctuation">.</span><span class="token keyword">user</span> <span class="token keyword">DROP</span> <span class="token keyword">FOREIGN</span> <span class="token keyword">KEY</span> <span class="token punctuation">`</span><span class="token operator">&lt;</span>外键名称<span class="token operator">&gt;</span><span class="token punctuation">`</span><span class="token punctuation">;</span>
</code></pre></div><h3 id="数据"><a href="#数据" aria-hidden="true" class="header-anchor">#</a> 数据</h3> <div class="language-sql extra-class"><pre class="language-sql"><code><span class="token comment"># 查询</span>
<span class="token keyword">SELECT</span> <span class="token operator">*</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 添加</span>
<span class="token keyword">INSERT</span> <span class="token keyword">INTO</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span><span class="token punctuation">(</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>sex<span class="token punctuation">`</span><span class="token punctuation">,</span> <span class="token punctuation">`</span>age<span class="token punctuation">`</span><span class="token punctuation">)</span> <span class="token keyword">VALUES</span> <span class="token punctuation">(</span><span class="token string">'张三'</span><span class="token punctuation">,</span><span class="token string">'1'</span><span class="token punctuation">,</span><span class="token number">25</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># 更新</span>
<span class="token keyword">UPDATE</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">SET</span> <span class="token punctuation">`</span>name<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'李四'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>sex<span class="token punctuation">`</span><span class="token operator">=</span><span class="token string">'2'</span><span class="token punctuation">,</span><span class="token punctuation">`</span>age<span class="token punctuation">`</span><span class="token operator">=</span><span class="token number">20</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>

<span class="token comment"># 删除</span>
<span class="token keyword">DELETE</span> <span class="token keyword">FROM</span> <span class="token punctuation">`</span><span class="token keyword">user</span><span class="token punctuation">`</span> <span class="token keyword">WHERE</span> id<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">;</span>
</code></pre></div><h2 id="备份和恢复"><a href="#备份和恢复" aria-hidden="true" class="header-anchor">#</a> 备份和恢复</h2> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">vi</span> /home/mysql.sh
</code></pre></div><h3 id="_1-mysql备份"><a href="#_1-mysql备份" aria-hidden="true" class="header-anchor">#</a> 1) MySQL备份</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
uname<span class="token operator">=</span>root
passwd<span class="token operator">=</span>***
dbname<span class="token operator">=</span>***
path<span class="token operator">=</span>***_<span class="token variable"><span class="token variable">`</span><span class="token function">date</span> <span class="token string">'+%Y-%m-%d'</span><span class="token variable">`</span></span>.sql
mysqldump -u<span class="token variable">$uname</span> -p<span class="token variable">$passwd</span> --databases <span class="token variable">$dbname</span> --lock-all-tables --flush-logs <span class="token operator">&gt;</span> <span class="token variable">$path</span>
</code></pre></div><h3 id="_2-mysql恢复"><a href="#_2-mysql恢复" aria-hidden="true" class="header-anchor">#</a> 2) MySQL恢复</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token shebang important">#!/bin/bash</span>
mysql -u<span class="token variable">$uname</span> -p<span class="token variable">$passwd</span> <span class="token variable">$dbname</span> <span class="token operator">&lt;</span> <span class="token variable">$path</span>
</code></pre></div><h3 id="_3-定时执行-每天23-30执行备份"><a href="#_3-定时执行-每天23-30执行备份" aria-hidden="true" class="header-anchor">#</a> 3) 定时执行(每天23:30执行备份)</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 添加定时</span>
<span class="token function">crontab</span> -e
<span class="token comment"># 内容</span>
30 23 * * * sh /home/mysql.sh
</code></pre></div><h3 id="_4-备份差异到本地目录"><a href="#_4-备份差异到本地目录" aria-hidden="true" class="header-anchor">#</a> 4) 备份差异到本地目录</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token function">rsync</span> -rvu --delete root@IP:/home/test/ /home/test
</code></pre></div><h3 id="_5-数据恢复"><a href="#_5-数据恢复" aria-hidden="true" class="header-anchor">#</a> 5) 数据恢复</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>mysql -u 用户名 -p密码 数据库名 <span class="token operator">&lt;</span> 备份的数据库.sql
</code></pre></div><h2 id="ssh免密码登录"><a href="#ssh免密码登录" aria-hidden="true" class="header-anchor">#</a> SSH免密码登录</h2> <h3 id="方法一："><a href="#方法一：" aria-hidden="true" class="header-anchor">#</a> 方法一：</h3> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># 生成公钥</span>
ssh-keygen -t rsa
<span class="token comment"># 将公钥放到服务器上</span>
<span class="token function">scp</span> ~/.ssh/id_rsa.pub root@IP:~/.ssh/authorized_keys
</code></pre></div><h3 id="方法二："><a href="#方法二：" aria-hidden="true" class="header-anchor">#</a> 方法二：</h3> <div class="language-bash extra-class"><pre class="language-bash"><code>pacman -S sshpass
sshpass -p <span class="token string">'你的密码'</span> <span class="token function">ssh</span> root@IP
</code></pre></div></div> <div class="page-edit"><!----> <!----></div> <div class="page-nav"><p class="inner"><span class="prev">
        ←
        <a href="/linux/shell/tools.html" class="prev">
          常用工具
        </a></span> <span class="next"><a href="/linux/shell/docker.html">
          Docker容器
        </a>
        →
      </span></p></div> </div> <!----></div></div>
    <script src="/assets/js/app.bdae1179.js" defer></script><script src="/assets/js/8.7187917d.js" defer></script>
  </body>
</html>
